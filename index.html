<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Percentage Calculator (Dark, Blue)</title>

    <!-- PWA: Link to the Web App Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- PWA: Set theme color for browser UI -->
    <meta name="theme-color" content="#2D2D2D">

    <style>
        /* Basic Reset & General Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: #2D2D2D;
            color: #EAEAEA;
            line-height: 1.5;
            padding: 10px;
        }

        .container {
            max-width: 650px;
            margin: 0 auto;
            width: 100%;
        }

        /* Header */
        header {
            margin-bottom: 20px;
            display: flex;
            align-items: center; /* Vertically align items */
            gap: 10px;
            flex-wrap: wrap;
        }

        .logo-img {
            display: block;
            width: 36px;
            height: 36px;
            flex-shrink: 0;
        }

        h1 {
            font-size: 1.6em;
            margin-bottom: 0;
            font-weight: 600;
            flex-grow: 1;
        }

        /* Calculator Section */
        .calculator-section {
            background-color: #3A3A3A;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 6px;
            border: 1px solid #484848;
            overflow: hidden;
        }

        .section-description {
            font-size: 0.85em;
            font-weight: 600;
            color: #AAAAAA;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        /* Input & Output Lines */
        .input-line, .output-line {
            display: flex;
            flex-wrap: nowrap;
            align-items: center;
            gap: 6px;
            overflow-x: auto;
            padding-bottom: 5px;
            margin-bottom: -5px;
        }

        .output-line {
            margin-top: 10px;
        }

        /* Input Fields */
        .calculator-section input[type="number"] {
            width: 85px;
            flex-shrink: 0;
            padding: 8px 10px;
            border: 1px solid #2196f3;
            background-color: #2D2D2D;
            color: #EAEAEA;
            border-radius: 4px;
            font-size: 0.95em;
            appearance: textfield;
            -moz-appearance: textfield;
        }
        .calculator-section input[type=number]::-webkit-inner-spin-button,
        .calculator-section input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Readonly Output Fields */
        .calculator-section input[readonly] {
            background-color: #444;
            cursor: default;
            border-color: #555;
             flex-grow: 1; /* Allow result field to grow */
             min-width: 50px;
             padding: 8px 10px;
             border-radius: 4px;
             font-size: 0.95em;
             color: #EAEAEA;
             border: 1px solid #555;
        }

        /* Select Dropdown Styling */
        .calculator-section select {
            padding: 6px 8px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            border: 1px solid #2196f3;
            background-color: #2D2D2D;
            color: #EAEAEA;
            border-radius: 4px;
            font-size: 0.95em;
            flex-shrink: 0;
            width: auto;
        }

        /* Labels and Text */
        .calculator-section span {
            font-size: 0.95em;
            color: #CFCFCF;
            flex-shrink: 0;
            white-space: nowrap;
        }

        /* Result Group (contains readonly input + %) */
        .result-group {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-grow: 1; /* Allow group to grow */
             min-width: 70px;
        }
        .result-group input[readonly] {
             flex-grow: 1; /* Input takes space within the group */
             width: auto;
             min-width: 50px;
        }
         .result-group span { /* The % sign */
             display: inline-block;
             width: auto;
             flex-shrink: 0;
        }

        /* Buttons */
        .calculator-section button { /* Style for CALCULATE buttons */
            padding: 9px 14px;
            background-color: #2196f3;
            color: #FFFFFF;
            border: none;
            border-radius: 4px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
            flex-shrink: 0;
            white-space: nowrap;
        }
        .calculator-section button:hover {
            background-color: #1976D2;
        }

        /* --- NEW: Clear Button Styling --- */
        .clear-btn {
            background-color: #616161; /* Mid-gray background */
            color: #bdbdbd; /* Lighter gray text */
            border: none;
            border-radius: 4px;
            font-size: 0.9em; /* Slightly smaller */
            font-weight: bold;
            line-height: 1; /* Ensure 'X' centers vertically */
            padding: 6px 9px; /* Smaller padding */
            cursor: pointer;
            flex-shrink: 0; /* Don't shrink */
            margin-left: 4px; /* Add a small gap after the result field */
            transition: background-color 0.2s ease;
        }
        .clear-btn:hover {
            background-color: #757575; /* Slightly lighter gray on hover */
            color: #e0e0e0;
        }
        /* --- END NEW CSS --- */


        /* Larger Screens (Optional tweaks) */
        @media (min-width: 600px) {
             /* Optional: Add tweaks here if needed */
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <img src="icons/icon-192.png" alt="Logo" class="logo-img">
            <h1>Percentage Calculator</h1>
        </header>

        <!-- Calculator 1: What is X% of Y? -->
        <section class="calculator-section" id="section-1"> <!-- Added section ID -->
             <h4 class="section-description">Find Percentage of Number</h4>
            <div class="input-line">
                <span>What is</span>
                <input type="number" id="calc1-percent" step="any" aria-label="Percentage value">
                <span>% of</span>
                <input type="number" id="calc1-base" step="any" aria-label="Base value">
            </div>
            <div class="output-line">
                <button id="calc1-btn">CALCULATE</button>
                <input type="text" id="calc1-result" readonly aria-label="Calculation result 1">
                <!-- ADDED CLEAR BUTTON -->
                <button class="clear-btn" id="clear-1" aria-label="Clear Section 1">X</button>
            </div>
        </section>

        <!-- Calculator 2: X is what percent of Y? -->
        <section class="calculator-section" id="section-2"> <!-- Added section ID -->
             <h4 class="section-description">Find Part's Percentage of Whole</h4>
             <div class="input-line">
                <input type="number" id="calc2-part" step="any" aria-label="Part value">
                <span>is what % of</span>
                <input type="number" id="calc2-whole" step="any" aria-label="Whole value">
            </div>
            <div class="output-line">
                 <button id="calc2-btn">CALCULATE</button>
                <div class="result-group">
                     <input type="text" id="calc2-result" readonly aria-label="Calculation result 2">
                     <span id="calc2-percent-symbol">%</span>
                </div>
                 <!-- ADDED CLEAR BUTTON -->
                <button class="clear-btn" id="clear-2" aria-label="Clear Section 2">X</button>
            </div>
        </section>

        <!-- Calculator 3: Percentage Increase/Decrease from X to Y -->
        <section class="calculator-section" id="section-3"> <!-- Added section ID -->
             <h4 class="section-description">Calculate Percentage Change</h4>
             <div class="input-line">
                <span>% change</span>
                <span>from</span>
                <input type="number" id="calc3-from" step="any" aria-label="Starting value">
                <span>to</span>
                <input type="number" id="calc3-to" step="any" aria-label="Ending value">
            </div>
            <div class="output-line">
                 <button id="calc3-btn">CALCULATE</button>
                 <div class="result-group">
                    <input type="text" id="calc3-result" readonly aria-label="Calculation result 3">
                    <span id="calc3-percent-symbol">%</span>
                </div>
                 <!-- ADDED CLEAR BUTTON -->
                <button class="clear-btn" id="clear-3" aria-label="Clear Section 3">X</button>
            </div>
        </section>

        <!-- Calculator 4: Increase/Decrease X by Y% -->
        <section class="calculator-section" id="section-4"> <!-- Added section ID -->
             <h4 class="section-description">Value After % Increase/Decrease</h4>
             <div class="input-line">
                <select id="calc4-operation" aria-label="Operation Type">
                    <option value="increase">Increase</option>
                    <option value="decrease">Decrease</option>
                </select>
                <input type="number" id="calc4-base" step="any" aria-label="Base value">
                <span>by</span>
                <input type="number" id="calc4-percent" step="any" aria-label="Percentage value">
                 <span>%</span>
            </div>
            <div class="output-line">
                 <button id="calc4-btn">CALCULATE</button>
                 <input type="text" id="calc4-result" readonly aria-label="Calculation result 4">
                  <!-- ADDED CLEAR BUTTON -->
                 <button class="clear-btn" id="clear-4" aria-label="Clear Section 4">X</button>
            </div>
        </section>

        <!-- Calculator 5: Reverse Percentage (Find Original) -->
        <section class="calculator-section" id="section-5"> <!-- Added section ID -->
             <h4 class="section-description">Find Original Value (Reverse %)</h4>
             <div class="input-line">
                <input type="number" id="calc5-final" step="any" aria-label="Final value">
                <span>is</span>
                <input type="number" id="calc5-percent" step="any" aria-label="Percentage value">
                <span>%</span>
                 <select id="calc5-operation" aria-label="Operation Type">
                    <option value="more">more than</option>
                    <option value="less">less than</option>
                </select>
                 <span>what?</span>
            </div>
            <div class="output-line">
                 <button id="calc5-btn">CALCULATE</button>
                 <input type="text" id="calc5-result" readonly aria-label="Calculation result 5 (Original Value)">
                  <!-- ADDED CLEAR BUTTON -->
                 <button class="clear-btn" id="clear-5" aria-label="Clear Section 5">X</button>
            </div>
        </section>
        <!-- End Calculator Sections -->

    </div>

    <!-- Calculator Logic Script -->
    <script>
       // Helper function to get float value or null if invalid/empty
        function getFloatValue(id) {
            const element = document.getElementById(id);
            if (!element || element.value.trim() === '') {
                return null;
            }
            const value = parseFloat(element.value);
            return isNaN(value) ? null : value;
        }

        // Helper function to display result or error
        function displayResult(id, value) {
            const element = document.getElementById(id);
            if (element) {
                if (value === null || typeof value === 'undefined' || value === '') {
                    element.value = '';
                } else if (typeof value === 'string') {
                     element.value = value; // Display error strings directly
                } else if (typeof value === 'number') {
                     element.value = parseFloat(value.toFixed(4)).toString(); // Limit decimals
                } else {
                     element.value = '';
                }
            }
        }

        // Helper to clear fields within a specific section
        function clearSectionFields(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                // Clear number inputs
                const numberInputs = section.querySelectorAll('input[type="number"]');
                numberInputs.forEach(input => input.value = '');
                // Clear result input (readonly text)
                const resultInput = section.querySelector('input[readonly]');
                if (resultInput) {
                    resultInput.value = '';
                }
                // Reset select dropdowns to first option (optional)
                const selects = section.querySelectorAll('select');
                selects.forEach(select => select.selectedIndex = 0);
            }
        }


         // Function to handle calculation and display (Generic, potentially used by Enter key if refactored)
        function performCalculation(calcFunction, outputId, ...inputIds) {
            const inputs = inputIds.map(id => getFloatValue(id));

            if (inputs.some(input => input === null)) {
                 displayResult(outputId, ''); // Clear result if inputs are not valid
                return;
            }

            try {
                const result = calcFunction(...inputs);
                 displayResult(outputId, result);
            } catch (error) {
                 displayResult(outputId, error.message);
            }
        }

        // --- Calculator Logic Functions ---
        function calculatePercentageOf(percent, base) {
            return (percent / 100) * base;
        }

        function calculateWhatPercent(part, whole) {
            if (whole === 0) return 'Cannot divide by zero';
            return (part / whole) * 100;
        }

        function calculatePercentChange(fromValue, toValue) {
            if (fromValue === 0) {
                return toValue === 0 ? 0 : 'Change from zero undefined';
            }
            const change = toValue - fromValue;
            return (change / Math.abs(fromValue)) * 100;
        }

        function calculateValueChange(operation, base, percent) {
             const numBase = Number(base);
             const numPercent = Number(percent);
             if (isNaN(numBase) || isNaN(numPercent)){
                 return 'Invalid input';
             }

            const changeAmount = (numPercent / 100) * numBase;
            if (operation === 'increase') {
                return numBase + changeAmount;
            } else if (operation === 'decrease') {
                return numBase - changeAmount;
            } else {
                return null;
            }
        }

        function calculateReversePercentage(finalValue, percent, operation) {
            const numFinal = Number(finalValue);
            const numPercent = Number(percent);

            if (isNaN(numFinal) || isNaN(numPercent)) {
                return 'Invalid input';
            }

            if (numPercent < 0) {
                 return 'Percentage cannot be negative';
            }

            let originalValue;
            const percentAsDecimal = numPercent / 100;

            if (operation === 'more') {
                 if (1 + percentAsDecimal === 0) {
                     return 'Calculation error';
                 }
                originalValue = numFinal / (1 + percentAsDecimal);
            } else if (operation === 'less') {
                if (percentAsDecimal >= 1) {
                     if (numFinal === 0 && percentAsDecimal === 1) return 0;
                     return 'Cannot be 100% or more less';
                }
                 if (1 - percentAsDecimal === 0) {
                      return 'Calculation error (div by zero)';
                 }
                originalValue = numFinal / (1 - percentAsDecimal);
            } else {
                return null;
            }

            return originalValue;
        }


        // --- Event Listeners for CALCULATE buttons ---
        document.getElementById('calc1-btn').addEventListener('click', function() {
             const percent = getFloatValue('calc1-percent');
             const base = getFloatValue('calc1-base');
             displayResult('calc1-result', ''); // Clear first
             if(percent === null || base === null) return;
             displayResult('calc1-result', calculatePercentageOf(percent, base));
        });

        document.getElementById('calc2-btn').addEventListener('click', function() {
            const part = getFloatValue('calc2-part');
             const whole = getFloatValue('calc2-whole');
             displayResult('calc2-result', ''); // Clear first
             if(part === null || whole === null) return;
             displayResult('calc2-result', calculateWhatPercent(part, whole));
        });

        document.getElementById('calc3-btn').addEventListener('click', function() {
            const fromValue = getFloatValue('calc3-from');
             const toValue = getFloatValue('calc3-to');
             displayResult('calc3-result', ''); // Clear first
             if(fromValue === null || toValue === null) return;
             displayResult('calc3-result', calculatePercentChange(fromValue, toValue));
        });

        document.getElementById('calc4-btn').addEventListener('click', function() {
            const operation = document.getElementById('calc4-operation').value;
            const base = getFloatValue('calc4-base');
            const percent = getFloatValue('calc4-percent');

            displayResult('calc4-result', ''); // Clear first

            if (base === null || percent === null) {
                return;
            }
             const result = calculateValueChange(operation, base, percent);
             displayResult('calc4-result', result);
        });

        document.getElementById('calc5-btn').addEventListener('click', function() {
            const finalValue = getFloatValue('calc5-final');
            const percent = getFloatValue('calc5-percent');
            const operation = document.getElementById('calc5-operation').value;

            displayResult('calc5-result', ''); // Clear first

            if (finalValue === null || percent === null) {
                return;
            }

            const result = calculateReversePercentage(finalValue, percent, operation);
            displayResult('calc5-result', result);
        });


        // --- Add Event Listeners for CLEAR buttons ---
        document.getElementById('clear-1').addEventListener('click', function() { clearSectionFields('section-1'); });
        document.getElementById('clear-2').addEventListener('click', function() { clearSectionFields('section-2'); });
        document.getElementById('clear-3').addEventListener('click', function() { clearSectionFields('section-3'); });
        document.getElementById('clear-4').addEventListener('click', function() { clearSectionFields('section-4'); });
        document.getElementById('clear-5').addEventListener('click', function() { clearSectionFields('section-5'); });


        // --- Add Enter key functionality ---
        const sections = document.querySelectorAll('.calculator-section');
        sections.forEach(section => {
            const inputs = section.querySelectorAll('.input-line input[type="number"]');
            const button = section.querySelector('.output-line button:not(.clear-btn)'); // Target CALCULATE button only
            if(inputs.length > 0 && button){
                inputs.forEach(input => {
                     input.addEventListener('keypress', function(event) {
                        if (event.key === 'Enter') {
                             event.preventDefault();
                             button.click();
                        }
                    });
                });
            }
        });
    </script>

    <!-- PWA: Script to Register the Service Worker (Using Absolute Path) -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/Percentage-Calc/service-worker.js')
            .then(registration => {
              console.log('Service Worker registered successfully with scope:', registration.scope);
            })
            .catch(error => {
              console.error('Service Worker registration failed:', error);
            });
        });
      }
    </script>

</body>
</html>
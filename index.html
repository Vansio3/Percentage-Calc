<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Percentage Calculator (Dark, Blue)</title>

    <!-- PWA: Link to the Web App Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- PWA: Set theme color for browser UI -->
    <meta name="theme-color" content="#2D2D2D">

    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* Basic Reset & General Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: #2D2D2D;
            color: #EAEAEA;
            line-height: 1.5;
            padding: 10px;
            user-select: none; /* Standard */
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE/Edge Legacy */
        }

        .container {
            max-width: 650px;
            margin: 0 auto;
            width: 100%;
        }

        /* Header */
        header {
            margin-bottom: 20px;
            display: flex;
            align-items: center; /* Vertically align items */
            gap: 10px;
            flex-wrap: wrap;
        }

        .logo-img {
            display: block;
            width: 36px;
            height: 36px;
            flex-shrink: 0;
        }

        h1 {
            font-size: 1.6em;
            margin-bottom: 0;
            font-weight: 600;
            flex-grow: 1;
        }

        /* Calculator Section */
        .calculator-section {
            background-color: #3A3A3A;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 6px;
            border: 1px solid #484848;
            overflow: hidden;
            position: relative; /* Needed for absolute positioning of clear button */
        }

        /* Clear Button Styling */
        .clear-section-btn {
            position: absolute;
            top: 8px;
            right: 10px;
            background: none;
            border: none;
            color: #AAAAAA;
            font-size: 1.5em;
            font-weight: bold;
            line-height: 1;
            padding: 0 4px;
            cursor: pointer;
            outline: none;
            box-shadow: none;
            -webkit-tap-highlight-color: transparent;
            z-index: 2;
            display: none; /* --- HIDE BY DEFAULT --- */
        }
         .clear-section-btn:focus,
         .clear-section-btn:active,
         .clear-section-btn:hover {
             outline: none !important;
             box-shadow: none !important;
             background: none !important;
             color: #AAAAAA !important;
             border: none !important;
         }

        /* Section Description Styling */
        .section-description {
            font-size: 0.85em;
            font-weight: 600;
            color: #AAAAAA;
            margin-bottom: 10px;
            line-height: 1.3;
            padding-right: 25px;
        }


        /* Input & Output Lines */
        .input-line, .output-line {
            display: flex;
            flex-wrap: nowrap;
            align-items: center;
            gap: 6px;
            overflow-x: auto;
            padding-bottom: 5px;
            margin-bottom: -5px;
        }

        .output-line {
            margin-top: 10px;
        }

        /* Input Fields */
        .calculator-section input[type="number"] {
            width: 85px;
            flex-shrink: 0;
            padding: 8px 10px;
            border: 1px solid #2196f3;
            background-color: #2D2D2D;
            color: #EAEAEA;
            border-radius: 4px;
            font-size: 0.95em;
            appearance: textfield;
            -moz-appearance: textfield;
            transition: border-color 0.2s ease-in-out;
        }
        .calculator-section input[type=number]::-webkit-inner-spin-button,
        .calculator-section input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .calculator-section input[type="number"]:focus {
            outline: none;
            box-shadow: none;
            border-color: #FF9800; /* Orange focus */
        }

        /* Readonly Output Fields */
        .calculator-section input[readonly] {
            background-color: #444;
            cursor: default;
            border-color: #555; /* Base border */
             flex-grow: 1;
             min-width: 50px;
             padding: 8px 10px;
             border-radius: 4px;
             font-size: 0.95em;
             color: #EAEAEA;
             border: 1px solid #555;
        }
        .calculator-section input[readonly]:focus {
            outline: none;
            box-shadow: none;
            border-color: #555; /* Keep border same as non-focused */
        }

        /* Select Dropdown Styling */
        .calculator-section select {
            padding: 6px 8px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            border: 1px solid #2196f3;
            background-color: #2D2D2D;
            color: #EAEAEA;
            border-radius: 4px;
            font-size: 0.95em;
            flex-shrink: 0;
            width: auto;
        }
         .calculator-section select:focus {
            outline: none;
            border-color: #FF9800;
            box-shadow: none;
         }


        /* Labels and Text */
        .calculator-section span {
            font-size: 0.95em;
            color: #CFCFCF;
            flex-shrink: 0;
            white-space: nowrap;
        }

        /* Result Group (contains readonly input + %) */
        .result-group {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-grow: 1; /* Group takes available space */
             min-width: 70px;
        }
        .result-group input[readonly] {
             flex-grow: 1; /* Input takes space within group */
             width: auto;
             min-width: 50px;
        }
         .result-group span { /* The % sign */
             display: inline-block;
             width: auto;
             flex-shrink: 0;
        }

        /* Calculate Buttons */
        .calculator-section button:not(.clear-section-btn):not(.copy-btn) { /* Target CALC buttons specifically */
            padding: 9px 14px;
            background-color: #2196f3;
            color: #FFFFFF;
            border: none;
            border-radius: 4px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
            flex-shrink: 0;
            white-space: nowrap;
        }
        .calculator-section button:not(.clear-section-btn):not(.copy-btn):hover {
            background-color: #1976D2;
        }
        .calculator-section button:not(.clear-section-btn):not(.copy-btn):focus {
            outline: none;
            box-shadow: none;
        }

        /* Copy Button Styling */
        .copy-btn {
            background: none;
            border: none;
            padding: 0 5px; /* Minimal padding */
            margin-left: 4px; /* Small space after result field/group */
            cursor: pointer;
            color: #AAAAAA; /* Match clear button color */
            font-size: 1em; /* Adjust icon size if needed */
            line-height: 1;
            outline: none;
            box-shadow: none;
            flex-shrink: 0; /* Prevent shrinking */
            -webkit-tap-highlight-color: transparent;
        }
        .copy-btn i { /* Style the icon itself */
            display: block; /* Helps with alignment */
        }
        .copy-btn:focus,
        .copy-btn:active,
        .copy-btn:hover {
            outline: none !important;
            box-shadow: none !important;
            background: none !important;
            color: #CCCCCC !important; /* Optional: Slightly lighten on hover */
            border: none !important;
        }


        /* Larger Screens (Optional tweaks) */
        @media (min-width: 600px) {
             /* Optional: Add tweaks here if needed */
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <img src="icons/icon-192.png" alt="Logo" class="logo-img">
            <h1>Percentage Calculator</h1>
        </header>

        <!-- Calculator 1: What is X% of Y? -->
        <section class="calculator-section">
             <button class="clear-section-btn" aria-label="Clear this section">Ã—</button>
             <h4 class="section-description">Find Percentage of Number</h4>
            <div class="input-line">
                <span>What is</span>
                <input type="number" id="calc1-percent" step="any" aria-label="Percentage value">
                <span>% of</span>
                <input type="number" id="calc1-base" step="any" aria-label="Base value">
            </div>
            <div class="output-line">
                <button id="calc1-btn">CALCULATE</button>
                <input type="text" id="calc1-result" readonly aria-label="Calculation result 1">
                <button class="copy-btn" id="copy-calc1-result" aria-label="Copy result 1" style="display: none;">
                    <i class="fa-regular fa-copy"></i>
                </button>
            </div>
        </section>

        <!-- Calculator 2: X is what percent of Y? -->
        <section class="calculator-section">
            <button class="clear-section-btn" aria-label="Clear this section">Ã—</button>
             <h4 class="section-description">Find Part's Percentage of Whole</h4>
             <div class="input-line">
                <input type="number" id="calc2-part" step="any" aria-label="Part value">
                <span>is what % of</span>
                <input type="number" id="calc2-whole" step="any" aria-label="Whole value">
            </div>
            <div class="output-line">
                 <button id="calc2-btn">CALCULATE</button>
                <div class="result-group">
                     <input type="text" id="calc2-result" readonly aria-label="Calculation result 2">
                     <span id="calc2-percent-symbol">%</span>
                </div>
                 <button class="copy-btn" id="copy-calc2-result" aria-label="Copy result 2" style="display: none;">
                    <i class="fa-regular fa-copy"></i>
                 </button>
            </div>
        </section>

        <!-- Calculator 3: Percentage Increase/Decrease from X to Y -->
        <section class="calculator-section">
             <button class="clear-section-btn" aria-label="Clear this section">Ã—</button>
             <h4 class="section-description">Calculate Percentage Change</h4>
             <div class="input-line">
                <span>% change</span>
                <span>from</span>
                <input type="number" id="calc3-from" step="any" aria-label="Starting value">
                <span>to</span>
                <input type="number" id="calc3-to" step="any" aria-label="Ending value">
            </div>
            <div class="output-line">
                 <button id="calc3-btn">CALCULATE</button>
                 <div class="result-group">
                    <input type="text" id="calc3-result" readonly aria-label="Calculation result 3">
                    <span id="calc3-percent-symbol">%</span>
                </div>
                  <button class="copy-btn" id="copy-calc3-result" aria-label="Copy result 3" style="display: none;">
                    <i class="fa-regular fa-copy"></i>
                 </button>
            </div>
        </section>

        <!-- Calculator 4: Increase/Decrease X by Y% -->
        <section class="calculator-section">
             <button class="clear-section-btn" aria-label="Clear this section">Ã—</button>
             <h4 class="section-description">Value After % Increase/Decrease</h4>
             <div class="input-line">
                <select id="calc4-operation" aria-label="Operation Type">
                    <option value="increase">Increase</option>
                    <option value="decrease">Decrease</option>
                </select>
                <input type="number" id="calc4-base" step="any" aria-label="Base value">
                <span>by</span>
                <input type="number" id="calc4-percent" step="any" aria-label="Percentage value">
                 <span>%</span>
            </div>
            <div class="output-line">
                 <button id="calc4-btn">CALCULATE</button>
                 <input type="text" id="calc4-result" readonly aria-label="Calculation result 4">
                  <button class="copy-btn" id="copy-calc4-result" aria-label="Copy result 4" style="display: none;">
                    <i class="fa-regular fa-copy"></i>
                 </button>
            </div>
        </section>

        <!-- Calculator 5: Reverse Percentage (Find Original) -->
        <section class="calculator-section">
             <button class="clear-section-btn" aria-label="Clear this section">Ã—</button>
             <h4 class="section-description">Find Original Value (Reverse %)</h4>
             <div class="input-line">
                <input type="number" id="calc5-final" step="any" aria-label="Final value">
                <span>is</span>
                <input type="number" id="calc5-percent" step="any" aria-label="Percentage value">
                <span>%</span>
                 <select id="calc5-operation" aria-label="Operation Type">
                    <option value="more">more than</option>
                    <option value="less">less than</option>
                </select>
                 <span>what?</span>
            </div>
            <div class="output-line">
                 <button id="calc5-btn">CALCULATE</button>
                 <input type="text" id="calc5-result" readonly aria-label="Calculation result 5 (Original Value)">
                 <button class="copy-btn" id="copy-calc5-result" aria-label="Copy result 5" style="display: none;">
                    <i class="fa-regular fa-copy"></i>
                 </button>
            </div>
        </section>
        <!-- End Calculator Sections -->

    </div>

    <!-- Calculator Logic Script -->
    <script>
       // Helper function to get float value or null if invalid/empty
        function getFloatValue(id) {
            const element = document.getElementById(id);
            if (!element || element.value.trim() === '') {
                return null;
            }
            const value = parseFloat(element.value);
            return isNaN(value) ? null : value;
        }

        // Helper function to display result or error
        function displayResult(id, value) {
            const element = document.getElementById(id);
            const copyBtnId = 'copy-' + id;
            const copyBtn = document.getElementById(copyBtnId);
            let showCopyBtn = false;

            if (element) {
                if (value === null || typeof value === 'undefined' || value === '') {
                    element.value = '';
                } else if (typeof value === 'string' && isNaN(parseFloat(value)) && value !== '0' ) {
                    element.value = value;
                } else if (typeof value === 'number' || (typeof value === 'string' && !isNaN(parseFloat(value))) ) {
                    element.value = parseFloat(Number(value).toFixed(4)).toString();
                    showCopyBtn = true;
                } else {
                     element.value = '';
                }
            }

            if (copyBtn) {
                copyBtn.style.display = showCopyBtn ? 'inline-block' : 'none';
            }
        }

        // Helper Function to Check Section Input State
        function checkSectionHasInput(sectionElement) {
            if (!sectionElement) return false;
            const numberInputs = sectionElement.querySelectorAll('.input-line input[type="number"]'); // Check only inputs in input line
            for (const input of numberInputs) {
                if (input.value.trim() !== '') return true;
            }
            const selectInputs = sectionElement.querySelectorAll('.input-line select'); // Check only selects in input line
            for (const select of selectInputs) {
                if (select.selectedIndex !== 0) return true;
            }
            return false;
        }

        // Function to Update Clear Button Visibility
        function updateClearButtonVisibility(sectionElement) {
            if (!sectionElement) return;
            const clearButton = sectionElement.querySelector('.clear-section-btn');
            if (clearButton) {
                clearButton.style.display = checkSectionHasInput(sectionElement) ? 'block' : 'none';
            }
        }

        // --- Calculator Logic Functions ---
        function calculatePercentageOf(percent, base) {
            return (percent / 100) * base;
        }

        function calculateWhatPercent(part, whole) {
            if (whole === 0) return 'Cannot divide by zero';
            return (part / whole) * 100;
        }

        function calculatePercentChange(fromValue, toValue) {
            if (fromValue === 0) {
                return toValue === 0 ? 0 : 'Change from zero undefined';
            }
            const change = toValue - fromValue;
            return (change / Math.abs(fromValue)) * 100;
        }

        function calculateValueChange(operation, base, percent) {
             const numBase = Number(base);
             const numPercent = Number(percent);
             if (isNaN(numBase) || isNaN(numPercent)){
                 return 'Invalid input';
             }
            const changeAmount = (numPercent / 100) * numBase;
            if (operation === 'increase') {
                return numBase + changeAmount;
            } else if (operation === 'decrease') {
                return numBase - changeAmount;
            } else { return null; }
        }

        function calculateReversePercentage(finalValue, percent, operation) {
            const numFinal = Number(finalValue);
            const numPercent = Number(percent);
            if (isNaN(numFinal) || isNaN(numPercent)) return 'Invalid input';
            if (numPercent < 0) return 'Percentage cannot be negative';

            let originalValue;
            const percentAsDecimal = numPercent / 100;

            if (operation === 'more') {
                 if (1 + percentAsDecimal === 0) return 'Calculation error';
                originalValue = numFinal / (1 + percentAsDecimal);
            } else if (operation === 'less') {
                if (percentAsDecimal >= 1) {
                     if (numFinal === 0 && percentAsDecimal === 1) return 0;
                     return 'Cannot be 100% or more less';
                }
                 if (1 - percentAsDecimal === 0) return 'Calculation error (div by zero)';
                originalValue = numFinal / (1 - percentAsDecimal);
            } else { return null; }
            return originalValue;
        }


        // --- Event Listeners for Calculate Buttons ---
        document.getElementById('calc1-btn').addEventListener('click', function() {
             const percent = getFloatValue('calc1-percent');
             const base = getFloatValue('calc1-base');
             displayResult('calc1-result', '');
             if(percent === null || base === null) return;
             displayResult('calc1-result', calculatePercentageOf(percent, base));
        });
        document.getElementById('calc2-btn').addEventListener('click', function() {
            const part = getFloatValue('calc2-part');
             const whole = getFloatValue('calc2-whole');
             displayResult('calc2-result', '');
             if(part === null || whole === null) return;
             displayResult('calc2-result', calculateWhatPercent(part, whole));
        });
        document.getElementById('calc3-btn').addEventListener('click', function() {
            const fromValue = getFloatValue('calc3-from');
             const toValue = getFloatValue('calc3-to');
             displayResult('calc3-result', '');
             if(fromValue === null || toValue === null) return;
             displayResult('calc3-result', calculatePercentChange(fromValue, toValue));
        });
        document.getElementById('calc4-btn').addEventListener('click', function() {
            const operation = document.getElementById('calc4-operation').value;
            const base = getFloatValue('calc4-base');
            const percent = getFloatValue('calc4-percent');
            displayResult('calc4-result', '');
            if (base === null || percent === null) return;
             const result = calculateValueChange(operation, base, percent);
             displayResult('calc4-result', result);
        });
        document.getElementById('calc5-btn').addEventListener('click', function() {
            const finalValue = getFloatValue('calc5-final');
            const percent = getFloatValue('calc5-percent');
            const operation = document.getElementById('calc5-operation').value;
            displayResult('calc5-result', '');
            if (finalValue === null || percent === null) return;
            const result = calculateReversePercentage(finalValue, percent, operation);
            displayResult('calc5-result', result);
        });


        // --- Add Enter key functionality ---
        const sections = document.querySelectorAll('.calculator-section');
        sections.forEach(section => {
            const inputs = section.querySelectorAll('.input-line input[type="number"]');
            const button = section.querySelector('.output-line button:not(.clear-section-btn):not(.copy-btn)');
            if(inputs.length > 0 && button){
                inputs.forEach(input => {
                     input.addEventListener('keypress', function(event) {
                        if (event.key === 'Enter') {
                             event.preventDefault();
                             button.click();
                        }
                    });
                });
            }
        });

         // --- Add Clear Button Functionality ---
        document.querySelectorAll('.clear-section-btn').forEach(button => {
            button.addEventListener('click', (event) => {
                const section = event.target.closest('.calculator-section');
                if (section) {
                    section.querySelectorAll('input[type="number"], input[type="text"]').forEach(input => {
                        input.value = '';
                    });
                    section.querySelectorAll('select').forEach(select => {
                        select.selectedIndex = 0;
                    });
                    section.querySelectorAll('.copy-btn').forEach(copyBtn => {
                        copyBtn.style.display = 'none';
                    });
                    // Re-check state to hide the clear button itself
                    updateClearButtonVisibility(section);
                }
            });
        });
        // --- End Clear Button Functionality ---


        // --- Add Copy Button Functionality ---
        document.querySelectorAll('.copy-btn').forEach(button => {
            button.addEventListener('click', async (event) => {
                const btn = event.target.closest('.copy-btn');
                const outputLine = btn.closest('.output-line');
                if (!outputLine) return;
                const resultInput = outputLine.querySelector('input[readonly]');
                if (resultInput && resultInput.value) {
                    try {
                        await navigator.clipboard.writeText(resultInput.value);
                        const icon = btn.querySelector('i');
                        if (icon) {
                            const originalIconClass = icon.className;
                            icon.className = 'fa-solid fa-check'; // Change to checkmark
                            setTimeout(() => {
                                icon.className = originalIconClass; // Change back
                            }, 1500);
                        }
                        console.log('Result copied to clipboard!');
                    } catch (err) {
                        console.error('Failed to copy text: ', err);
                    }
                }
            });
        });
        // --- End Copy Button Functionality ---


         // --- Add Input/Change Listeners to Sections for Clear Button ---
        document.querySelectorAll('.calculator-section').forEach(section => {
            section.addEventListener('input', (event) => {
                if (event.target.matches('.input-line input[type="number"]')) {
                    updateClearButtonVisibility(section);
                }
            });
            section.addEventListener('change', (event) => {
                if (event.target.matches('.input-line select')) {
                    updateClearButtonVisibility(section);
                }
            });
        });
        // --- End Input/Change Listeners ---


    </script>

    <!-- PWA: Script to Register the Service Worker (Using Absolute Path) -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/Percentage-Calc/service-worker.js')
            .then(registration => {
              console.log('Service Worker registered successfully with scope:', registration.scope);
            })
            .catch(error => {
              console.error('Service Worker registration failed:', error);
            });
        });
      }
    </script>

</body>
</html>